/*Script generated by IBUtils  <<DATETIME>> */

CREATE TABLE <<TABLE_NAME>> (
  <<PK_NAME>> DM_BIGINT NOT NULL,
  CREATED DM_TIMESTAMP DEFAULT 'NOW' NOT NULL,
  CREATED_BY DM_VARCHAR31 DEFAULT CURRENT_USER collate PXW_CSY,
  CHANGED DM_TIMESTAMP,
  CHANGED_BY DM_VARCHAR31 collate PXW_CSY);


/* Unique keys definition */

ALTER TABLE <<TABLE_NAME>> ADD CONSTRAINT PK_<<TABLE_NAME>> PRIMARY KEY (<<PK_NAME>>);

/*Generator definition*/

CREATE GENERATOR G_<<TABLE_NAME>>__<<PK_NAME>>;

/* Triggers definition */

SET TERM ^ ;


CREATE TRIGGER <<TABLE_NAME>>_BU FOR <<TABLE_NAME>> ACTIVE
BEFORE UPDATE POSITION 7
AS
BEGIN
  NEW.CHANGED = CURRENT_TIMESTAMP;
  NEW.CHANGED_BY = CURRENT_USER;
END
^


CREATE TRIGGER <<TABLE_NAME>>_BI FOR <<TABLE_NAME>> ACTIVE
BEFORE INSERT POSITION 7
AS
BEGIN
  IF (NEW.<<PK_NAME>> IS NULL) THEN
    NEW.<<PK_NAME>> = GEN_ID(G_<<TABLE_NAME>>__<<PK_NAME>>, 1);
  NEW.CREATED = CURRENT_TIMESTAMP;
  NEW.CREATED_BY = CURRENT_USER;
END
^


SET TERM ; ^

/* Default Privileges */
GRANT ALL ON <<TABLE_NAME>> TO "PUBLIC";
GRANT UPDATE, REFERENCES ON <<TABLE_NAME>> TO TRIGGER <<TABLE_NAME>>_BU;
GRANT UPDATE, REFERENCES ON <<TABLE_NAME>> TO TRIGGER <<TABLE_NAME>>_BI;

